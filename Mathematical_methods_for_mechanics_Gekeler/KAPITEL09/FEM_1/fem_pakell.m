function [SE,ME,BE,ecode] = pakell(X,Y)
% Elliptische RWP, vgl. SCHWARZ: FEM
% kubischer Ansatz der Serendipity-Klasse
% liefert die Elementmatrizen SE(12,12) und ME(12,12) sowie
% den Elementvektor BE(12) fuer ein Parallelogrammelement
% INPUT:
%        X,Y die drei wesentlichen Eckenkoordinatenpaare
% OUTPUT:
%        SE, ME, BE
%        ecode = 1 bei falscher Orientierung

S1 = [552  42  66  -552  42  -66  -204   21   39   204   21  -39;
       42  56   0   -42 -14    0   -21   -7    0    21   28    0;
       66   0  12   -66   0  -12   -39    0    9    39    0   -9;
     -552 -42 -66   552 -42   66   204  -21  -39  -204  -21   39;
       42 -14   0   -42  56    0   -21   28    0    21   -7    0;
      -66   0 -12    66   0   12    39    0   -9   -39    0    9;
     -204 -21 -39   204 -21   39   552  -42  -66  -552  -42   66;
       21  -7   0   -21  28    0   -42   56    0    42  -14    0;
       39   0   9   -39   0   -9   -66    0   12    66    0  -12;
      204  21  39  -204  21  -39  -552   42   66   552   42  -66;
       21  28   0   -21  -7    0   -42  -14    0    42   56    0;
      -39   0  -9    39   0    9    66    0  -12   -66    0   12];

S2 = [1260  -252   252  -1260   252  -252 -1260   252   252  1260   -252 -252;
       252     0    35  -252     42   -35  -252    42    35   252      0  -35;
      -252    35     0   252    -35     0  -252    35    42   252    -35  -42;
      1260   252   252 -1260   -252  -252 -1260  -252   252  1260    252 -252;
      -252   -42   -35   252      0    35   252     0   -35  -252    -42   35;
      -252   -35     0   252     35     0  -252   -35    42   252     35  -42;
     -1260  -252  -252  1260    252   252  1260   252  -252 -1260   -252  252;
       252    42    35  -252      0   -35  -252     0    35   252     42  -35;
       252    35    42  -252    -35   -42   252    35     0  -252    -35    0;
     -1260   252  -252  1260   -252   252  1260  -252  -252 -1260    252  252;
      -252     0   -35   252    -42    35   252   -42   -35  -252      0   35;
       252   -35    42  -252     35   -42   252   -35     0  -252     35    0];

S3 =  [552    66    42   204    -39    21  -204    39    21  -552    -66   42;
        66    12     0    39     -9     0   -39     9     0   -66    -12    0;
        42     0    56    21      0    28   -21     0    -7   -42      0  -14;
       204    39    21   552    -66    42  -552    66    42  -204    -39   21;
       -39    -9     0   -66     12     0    66   -12     0    39      9    0;
        21     0    28    42      0    56   -42     0   -14   -21      0   -7;
      -204   -39   -21  -552     66   -42   552   -66   -42   204     39  -21;
        39     9     0    66    -12     0   -66    12     0   -39     -9    0;
        21     0    -7    42      0   -14   -42     0    56   -21      0   28;
      -552   -66   -42  -204     39   -21   204   -39   -21   552     66  -42;
       -66   -12     0   -39      9     0    39    -9     0    66     12    0;
        42     0   -14    21      0    -7   -21     0    28   -42      0   56];
S4 = [3454   461   461  1226   -274   199   394  -116  -116  1226    199 -274;
       461    80    63   274    -60    42   116   -30   -28   199     40  -42;
       461    63    80   199    -42    40   116   -28   -30   274     42  -60;
      1226   274   199  3454   -461   461  1226  -199  -274   394    116 -116;
      -274   -60   -42  -461     80   -63  -199    40    42  -116    -30   28;
       199    42    40   461    -63    80   274   -42   -60   116     28  -30;
       394   116   116  1226   -199   274  3454  -461  -461  1226    274 -199;
      -116   -30   -28  -199     40   -42  -461    80    63  -274    -60   42;
      -116   -28   -30  -274     42   -60  -461    63    80  -199    -42   40;
      1226   199   274   394   -116   116  1226  -274  -199  3454    461 -461;
       199    40    42   116    -30    28   274   -60   -42   461     80  -63;
      -274   -42   -60  -116     28   -30  -199    42    40  -461    -63   80];
      SB = [6; 1; 1; 6; -1; 1; 6; -1; -1; 6; 1; -1];

ecode = 0;
X21 = X(2) - X(1); X31 = X(3) - X(1);
Y21 = Y(2) - Y(1); Y31 = Y(3) - Y(1);
DET = X21*Y31 - X31*Y21;
if DET <= 0, ecode = 1; else
   A  =  (X31*X31 + Y31*Y31)/DET;
   B  = -(X21*X31 + Y21*Y31)/(4*DET);
   C  =  (X21*X21 + Y21*Y21)/DET;
   BE = DET*SB/24;
   SE = (A*S1 + B*(S2+ S2') + C*S3)/1260;
   ME = DET*S4/25200;
end

for J = [2,5,8,11]
   for I = 1:12
      H1        = X21*SE(I,J) + X31*SE(I,J+1);
      SE(I,J+1) = Y21*SE(I,J) + Y31*SE(I,J+1);
      SE(I,J)   = H1;
      H1        = X21*ME(I,J) + X31*ME(I,J+1);
      ME(I,J+1) = Y21*ME(I,J) + Y31*ME(I,J+1);
      ME(I,J)   = H1;
   end
end
for I = [2,5,8,11]
   for J = 1:12
      H1        = X21*SE(I,J) + X31*SE(I+1,J);
      SE(I+1,J) = Y21*SE(I,J) + Y31*SE(I+1,J);
      SE(I,J)   = H1;
      H1        = X21*ME(I,J) + X31*ME(I+1,J);
      ME(I+1,J) = Y21*ME(I,J) + Y31*ME(I+1,J);
      ME(I,J)   = H1;
   end
   H1          = X21*BE(I) + X31*BE(I+1);
   BE(I+1)     = Y21*BE(I) + Y31*BE(I+1);
   BE(I)       = H1;
end
