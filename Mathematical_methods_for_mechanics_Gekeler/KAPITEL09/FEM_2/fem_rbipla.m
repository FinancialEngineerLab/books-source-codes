function [SE,ME,BE,ecode] = fem_rbipla(XK,YK,E,NU,H,P)
% -- GEKELER: FINITE ELEMENTE, vgl. SCHWARZ: FEM ---------
% LIEFERT DIE ELEMENTMATRIZEN SE(16,16) UND ME(16,16) SOWIE DEN
% ELEMENTVEKTOR BE(16) FUER EIN KONFORMES RECHTECKELEMENT
% BIKUBISCHER ANSATZ, PLATTENPROBLEME
% XK, YK : DIE DREI WESENTLICHEN ECKENKOORDINATENPAARE
% E : ELASTIZITAETSMODUL,  NU : POISSONZAHL
% H : DICKE DES ELEMENTES,  P : BELASTUNG DES ELEMENTES
% ecode : WIRD BEI FALSCHER ORIENTIERUNG ODER BEI NICHT
%         ACHSENPARALLELER LAGE GLEICH "1" GESETZT
%----------------------------------------------------
S1 = [936,468,132,66,-936,468,-132,66, -324,162,...
      78,-39,324,162,-78,-39,  312,66,44,-468,156,-66,22,-162,...
      54,39,-13,162,108,-39,-26,  24,12,-132,66,-24,12,-78,39,...
      18,-9,78,39,-18,-9,  8,-66,22,-12,4,-39,13,9,-3,39,26,...
      -9,-6,  936,-468,132,-66,324,-162,-78,39,-324,-162,78,...
      39,  312,-66,44,-162,108,39,-26,162,54,-39,-13,  24,-12,...
      78,-39,-18,9,-78,-39,18,9,  8,-39,26,9,-6,39,13,-9,-3,...
      936,-468,-132,66,-936,-468,132,66,  312,66,-44,468,156,...
      -66,-22,  24,-12,132,66,-24,-12,  8,-66,-22,12,4,  936,...
      468,-132,-66,  312,-66,-44,  24,12,  8];
S3 = [1296,648,648,99,-1296,108,-648,54,1296,-108,...
      -108,9,-1296,-648,108,54,  144,549,72,-108,-36,-54,-18,...
       108,36,-9,-3,-648,-144,54,12,  144,72,-648,54,-144,12,...
       108,-9,36,-3,-108,-54,-36,-18,  16,-54,-18,-12,-4,9,3,3,...
      1,-54,-12,-18,-4,  1296,-648,648,-99,-1296,648,108,-54,...
      1296,108,-108,-9,  144,-549,72,648,-144,-54,12,-108,36,9,...
      -3,  144,-72,-108,54,-36,18,108,9,36,3,  16,54,-12,18,-4,...
      -9,3,-3,1,  1296,-648,-648,99,-1296,-108,648,54,  144,...
      549,-72,108,-36,-54,18,  144,-72,648,54,-144,-12,  16,...
      -54,18,12,-4,  1296,648,-648,-99,  144,-549,-72,  144,72,...
      16];
S4 = [1296,108,108,9,-1296,108,-108,9,1296,-108,...
      -108,9,-1296,-108,108,9,  144,9,12,-108,-36,-9,-3,108,36,...
      -9,-3,-108,-144,9,12,  144,12,-108,9,-144,12,108,-9,36,...
      -3,-108,-9,-36,-3,  16,-9,-3,-12,-4,9,3,3,1,-9,-12,-3,-4,...
      1296,-108,108,-9,-1296,108,108,-9,1296,108,-108,-9,  144,...
      -9,12,108,-144,-9,12,-108,36,9,-3,  144,-12,-108,9,-36,3,...
      108,9,36,3,  16,9,-12,3,-4,-9,3,-3,1,  1296,-108,-108,9,...
     -1296,-108,108,9,  144,9,-12,108,-36,-9,3,  144,-12,108,...
      9,-144,-12,  16,-9,3,12,-4,  1296,108,-108,-9,  144,-9,...
      -12,  144,12,  16];
S6 = [936,132,468,66,324,-78,162,-39,-324,78,162,...
      -39,-936,-132,468,66,  24,66,12,78,-18,39,-9,-78,18,39,...
      -9,-132,-24,66,12,  312,44,162,-39,108,-26,-162,39,54,...
      -13,-468,-66,156,22,  8,39,-9,26,-6,-39,9,13,-3,-66,-12,...
       22,4,  936,-132,468,-66,-936,132,468,-66,-324,-78,162,39,...
      24,-66,12,132,-24,-66,12,78,18,-39,-9,  312,-44,-468,66,...
      156,-22,-162,-39,54,13,  8,66,-12,-22,4,39,9,-13,-3,...
      936,-132,-468,66,324,78,-162,-39,  24,66,-12,-78,-18,39,...
      9,  312,-44,-162,-39,108,26,  8,39,9,-26,-6,  936,132,...
      -468,-66,  24,-66,-12,  312,44,  8];
S7 = [24336,3432,3432,484,8424,-2028,1188,-286,...
      2916,-702,-702,169,8424,1188,-2028,-286,  624,484,88,2028,...
      -468,286,-66,702,-162,-169,39,1188,216,-286,-52,  624,88,...
      1188,-286,216,-52,702,-169,-162,39,2028,286,-468,-66,...
      16,286,-66,52,-12,169,-39,-39,9,286,52,-66,-12,  24336,...
      -3432,3432,-484,8424,-1188,-2028,286,2916,702,-702,-169,...
      624,-484,88,-1188,216,286,-52,-702,-162,169,39,  624,-88,...
      2028,-286,-468,66,702,169,-162,-39,  16,-286,52,66,-12,...
      -169,-39,39,9,  24336,-3432,-3432,484,8424,2028,-1188,...
      -286,  624,484,-88,-2028,-468,286,66,  624,-88,-1188,-286,...
      216,52,  16,286,66,-52,-12,  24336,3432,-3432,-484,  624,...
      -484,-88,  624,88,  16];
SB = [36,6,6,1,36,-6,6,-1,36,-6,-6,1,36,6,-6,-1];
ecode = 0;
SE = zeros(16,16); ME = zeros(16,16); BE = zeros(16,1);
X21 = XK(2) - XK(1); X31 = XK(3) - XK(1);
Y21 = YK(2) - YK(1); Y31 = YK(3) - YK(1);
D = E * H * H * H /(12 * ( 1 - NU * NU));
DET = X21 * Y31 - X31 * Y21;
if DET <= 0, ecode = 1;
else
   DET3 = DET * DET * DET / D;
   H1 = X31 * X31 + Y31 * Y31;
   H2 = X21 * X31 + Y21 * Y31;
   H3 = X21 * X21 + Y21 * Y21;
   if abs(H2) >= 1.0e-10
      ecode = 2;
      disp('Rechteck nicht in achsenparalleler Lage');
   else
      A1 = H1 * H1 / (DET3 * 210);
      A3 = NU * D / (DET * 450);
      A4 = (1 - NU) * D / (DET * 450);
      A6 = H3 * H3 / (DET3 * 210);
      IJ = 0;
      for I = 1:16
         for J = I:16
            IJ = IJ + 1;
            SE(I,J) = A1*S1(IJ) + A3*S3(IJ) + A4*S4(IJ) + A6*S6(IJ);
            SE(J,I) = SE(I,J);
            ME(I,J) = DET * S7(IJ) / 176400;
            ME(J,I) = ME(I,J);
         end
         BE(I) = P * DET * SB(I) / 144;
      end
      for J = [2,6,10,14]
         for I = 1:16
            SE(I,J)   = X21 * SE(I,J);
            SE(I,J+1) = Y31 * SE(I,J+1);
            SE(I,J+2) = X21 * Y31 * SE(I,J+2);
            ME(I,J)   = X21 * ME(I,J);
            ME(I,J+1) = Y31 * ME(I,J+1);
            ME(I,J+2) = X21 * Y31 * ME(I,J+2);
            SE(J,I)   = X21 * SE(J,I);
            SE(J+1,I) = Y31 * SE(J+1,I);
            SE(J+2,I) = X21 * Y31 * SE(J+2,I);
            ME(J,I)   = X21 * ME(J,I);
            ME(J+1,I) = Y31 * ME(J+1,I);
            ME(J+2,I) = X21 * Y31 * ME(J+2,I);
         end
         BE(J)   = X21 * BE(J);
         BE(J+1) = Y31 * BE(J+1);
         BE(J+2) = X21 * Y31 * BE(J+2);
      end
   end
end
